---
title: requestAnimationFrame ä»»åŠ¡åˆ†ç‰‡ - è§£å†³å¤§æ•°æ®æ¸²æŸ“å¡é¡¿é—®é¢˜
date: 2025-08-12
categories:
 - frontEnd
tags:
 - æ€§èƒ½ä¼˜åŒ–
 - requestAnimationFrame
 - JavaScript
 - Vue
author: zhaoyifan
---

## é—®é¢˜èƒŒæ™¯

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦æ¸²æŸ“å¤§é‡æ•°æ®çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼š

- ğŸ“‹ æ¸²æŸ“ 10000+ æ¡åˆ—è¡¨æ•°æ®
- ğŸ“Š å±•ç¤ºå¤§é‡å›¾è¡¨æ•°æ®ç‚¹
- ğŸ¨ æ‰¹é‡åˆ›å»º DOM å…ƒç´ 
- ğŸ“ é•¿æ–‡æ¡£çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

å¦‚æœä¸€æ¬¡æ€§æ¸²æŸ“æ‰€æœ‰æ•°æ®ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- **é¡µé¢å¡é¡¿**ï¼šä¸»çº¿ç¨‹è¢«é•¿æ—¶é—´å ç”¨ï¼Œç”¨æˆ·æ— æ³•æ“ä½œ
- **ç™½å±æ—¶é—´é•¿**ï¼šç”¨æˆ·éœ€è¦ç­‰å¾…æ‰€æœ‰å†…å®¹åŠ è½½å®Œæˆæ‰èƒ½çœ‹åˆ°é¡µé¢
- **æµè§ˆå™¨å‡æ­»**ï¼šæç«¯æƒ…å†µä¸‹æµè§ˆå™¨å¯èƒ½ä¼šæç¤º"é¡µé¢æ— å“åº”"

## è§£å†³æ–¹æ¡ˆï¼šä»»åŠ¡åˆ†ç‰‡

**ä»»åŠ¡åˆ†ç‰‡ï¼ˆTime Slicingï¼‰** çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å°†å¤§ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œåˆ†æ•£åˆ°å¤šä¸ªæµè§ˆå™¨å¸§ä¸­æ‰§è¡Œ**ã€‚

é€šè¿‡ `requestAnimationFrame` å®ç°ä»»åŠ¡åˆ†ç‰‡ï¼Œè®©æ•°æ®åœ¨æ¯ä¸€å¸§é€æ­¥æ¸²æŸ“ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œä¿æŒé¡µé¢æµç•…ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© requestAnimationFrameï¼Ÿ

ç›¸æ¯”äº `setTimeout` å’Œ `setInterval`ï¼Œ`requestAnimationFrame` æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… **ä¸æµè§ˆå™¨åˆ·æ–°ç‡åŒæ­¥**ï¼šé€šå¸¸ 60fpsï¼Œæ¯å¸§çº¦ 16.6ms
- âœ… **è‡ªåŠ¨ä¼˜åŒ–**ï¼šé¡µé¢ä¸å¯è§æ—¶ä¼šæš‚åœæ‰§è¡Œï¼ŒèŠ‚çœèµ„æº
- âœ… **æ›´æµç•…**ï¼šä¸“ä¸ºåŠ¨ç”»å’Œè§†è§‰æ›´æ–°è®¾è®¡
- âœ… **ä¸ä¼šæ‰å¸§**ï¼šå›è°ƒåœ¨é‡ç»˜ä¹‹å‰æ‰§è¡Œï¼Œç¡®ä¿åŠ¨ç”»æµç•…

## æ ¸å¿ƒå®ç°ï¼šuseDeferredDisplay Hook

### åŸç†è§£æ

åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œé€šè¿‡ `requestAnimationFrame` åœ¨æ¯ä¸€å¸§é€’å¢ step ä¸ªï¼ˆé»˜è®¤ 100ï¼‰ï¼Œç»„ä»¶é€šè¿‡ `shouldShow(n)` åˆ¤æ–­å½“å‰æ˜¯å¦åº”è¯¥æ¸²æŸ“ç¬¬ n ä¸ªå…ƒç´ ã€‚

**æ¸²æŸ“é€Ÿåº¦è®¡ç®—ï¼š** 60 å¸§/ç§’ Ã— 100 ä¸ª/å¸§ = 6000 ä¸ª/ç§’ï¼Œå› æ­¤ 10000 æ¡æ•°æ®çº¦éœ€ 1.6 ç§’å®Œæˆæ¸²æŸ“ã€‚

```javascript
// step: æ¯å¸§æ¸²æŸ“çš„æ•°é‡ï¼Œé»˜è®¤ 100
// å³æ¯ç§’æ¸²æŸ“ 6000 ä¸ªï¼Œ10000 ä¸ªæ•°æ®çº¦ 1.6 ç§’å®Œæˆ
function useDeferredDisplay(step = 100) {
  const count = ref(0);
  let rafId = null;

  function update() {
    count.value += step;
    rafId = requestAnimationFrame(update);
  }

  update();

  // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
  onBeforeUnmount(() => {
    if (rafId) {
      cancelAnimationFrame(rafId);
    }
  });

  // è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦åº”è¯¥æ¸²æŸ“ç¬¬ n ä¸ªå…ƒç´ 
  return function (n) {
    return count.value >= n;
  };
}
```

### ä½¿ç”¨æ–¹å¼

```vue
<template>
  <div class="list">
    <div 
      v-for="item in listData" 
      :key="item.id"
      v-show="shouldShow(item.id)"
      class="item"
    >
      <div class="avatar">{{ item.id }}</div>
      <div class="item-content">
        <div class="item-title">{{ item.title }}</div>
        <div class="item-desc">{{ item.desc }}</div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';

// ä½¿ç”¨ Hook
const shouldShow = useDeferredDisplay();

// ç”Ÿæˆ 10000 æ¡æ•°æ®
const listData = ref(
  Array.from({ length: 10000 }, (_, index) => ({
    id: index + 1,
    title: `æ•°æ®é¡¹ #${index + 1}`,
    desc: `è¿™æ˜¯ç¬¬ ${index + 1} æ¡æ•°æ®çš„æè¿°ä¿¡æ¯`
  }))
);

// è®¡ç®—æ¸²æŸ“è¿›åº¦
const renderProgress = computed(() => {
  const rendered = listData.value.filter(item => shouldShow(item.id)).length;
  return Math.floor((rendered / listData.value.length) * 100);
});
</script>
```

## å®ç°æ•ˆæœå¯¹æ¯”

### âŒ æœªä¼˜åŒ–ç‰ˆæœ¬ï¼ˆä¸€æ¬¡æ€§æ¸²æŸ“ï¼‰

```vue
<template>
  <div class="list">
    <!-- ä¸€æ¬¡æ€§æ¸²æŸ“æ‰€æœ‰æ•°æ® -->
    <div v-for="item in listData" :key="item.id" class="item">
      {{ item.title }}
    </div>
  </div>
</template>
```

**é—®é¢˜ï¼š**
- âš ï¸ é¦–æ¬¡æ¸²æŸ“æ—¶é—´é•¿è¾¾ 2-3 ç§’
- âš ï¸ é¡µé¢å®Œå…¨å¡æ­»ï¼Œæ— æ³•æ»šåŠ¨æˆ–ç‚¹å‡»
- âš ï¸ ç”¨æˆ·ä½“éªŒæå·®

### âœ… ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆä»»åŠ¡åˆ†ç‰‡ï¼‰

```vue
<template>
  <div class="list">
    <!-- é€å¸§æ¸²æŸ“ -->
    <div 
      v-for="item in listData" 
      :key="item.id"
      v-show="shouldShow(item.id)"
      class="item"
    >
      {{ item.title }}
    </div>
  </div>
</template>
```

**ä¼˜åŠ¿ï¼š**
- âœ… é¦–å±å†…å®¹ç«‹å³å¯è§ï¼ˆ< 100msï¼‰
- âœ… é¡µé¢ä¿æŒæµç•…ï¼Œå¯ä»¥æ­£å¸¸æ»šåŠ¨å’Œäº¤äº’
- âœ… æ•°æ®é€æ­¥æ¸²æŸ“ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- âœ… æµè§ˆå™¨ä¸ä¼šå‡ºç°"é¡µé¢æ— å“åº”"æç¤º

## å®Œæ•´ç¤ºä¾‹ä»£ç 

### HTML + Vue 3 å®ç°

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>requestAnimationFrame ä»»åŠ¡åˆ†ç‰‡æ€§èƒ½ä¼˜åŒ–</title>
  <style>
    .list {
      max-height: 600px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }

    .item {
      padding: 12px 15px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .item:nth-child(even) {
      background: #fafafa;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: bold;
    }

    .item-content {
      flex: 1;
    }

    .item-title {
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
    }

    .item-desc {
      font-size: 12px;
      color: #999;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <h1>ğŸš€ requestAnimationFrame ä»»åŠ¡åˆ†ç‰‡æ€§èƒ½ä¼˜åŒ–</h1>
      
      <div class="controls">
        <button @click="reload">ğŸ”„ é‡æ–°åŠ è½½æ•°æ®</button>
        <div class="performance-info">
          <div class="perf-item">
            <span class="perf-label">æ•°æ®é‡</span>
            <span class="perf-value">{{ total }}</span>
          </div>
          <div class="perf-item">
            <span class="perf-label">æ¸²æŸ“è¿›åº¦</span>
            <span class="perf-value">{{ renderProgress }}%</span>
          </div>
        </div>
      </div>

      <div class="demo-container">
        <!-- æœªä¼˜åŒ–ç‰ˆæœ¬ -->
        <div class="demo-box">
          <h3>âŒ æœªä¼˜åŒ–ï¼ˆä¸€æ¬¡æ€§æ¸²æŸ“ï¼‰</h3>
          <div class="list">
            <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
            <div v-else>
              <div class="item" v-for="item in listData" :key="item.id">
                <div class="avatar">{{ item.id }}</div>
                <div class="item-content">
                  <div class="item-title">{{ item.title }}</div>
                  <div class="item-desc">{{ item.desc }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ä¼˜åŒ–ç‰ˆæœ¬ -->
        <div class="demo-box">
          <h3>âœ… å·²ä¼˜åŒ–ï¼ˆä»»åŠ¡åˆ†ç‰‡ï¼‰</h3>
          <div class="list">
            <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
            <div v-else>
              <div 
                class="item" 
                v-for="item in listData" 
                :key="'defer-' + item.id"
                v-show="shouldShow(item.id)"
              >
                <div class="avatar">{{ item.id }}</div>
                <div class="item-content">
                  <div class="item-title">{{ item.title }}</div>
                  <div class="item-desc">{{ item.desc }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script>
    const { createApp, ref, computed, onBeforeUnmount } = Vue;

    // æ ¸å¿ƒ Hookï¼šuseDeferredDisplay
    // step: æ¯å¸§æ¸²æŸ“çš„æ•°é‡ï¼Œé»˜è®¤ 100ï¼ˆå³æ¯ç§’æ¸²æŸ“ 6000 ä¸ªï¼Œ10000 ä¸ªæ•°æ®çº¦ 1.6 ç§’å®Œæˆï¼‰
    function useDeferredDisplay(step = 100) {
      const count = ref(0);
      let rafId = null;

      function update() {
        count.value += step;
        rafId = requestAnimationFrame(update);
      }

      update();

      // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
      onBeforeUnmount(() => {
        if (rafId) {
          cancelAnimationFrame(rafId);
        }
      });

      // è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦åº”è¯¥æ¸²æŸ“ç¬¬ n ä¸ªå…ƒç´ 
      return function (n) {
        return count.value >= n;
      };
    }

    createApp({
      setup() {
        const total = 10000;
        const listData = ref([]);
        const loading = ref(false);
        const shouldShow = useDeferredDisplay();

        // è®¡ç®—æ¸²æŸ“è¿›åº¦
        const renderProgress = computed(() => {
          const rendered = listData.value.filter(item => shouldShow(item.id)).length;
          return Math.floor((rendered / total) * 100);
        });

        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        function generateData() {
          return Array.from({ length: total }, (_, index) => ({
            id: index + 1,
            title: `æ•°æ®é¡¹ #${index + 1}`,
            desc: `è¿™æ˜¯ç¬¬ ${index + 1} æ¡æ•°æ®çš„æè¿°ä¿¡æ¯`
          }));
        }

        // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
        function reload() {
          loading.value = true;
          listData.value = [];
          
          // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
          setTimeout(() => {
            listData.value = generateData();
            loading.value = false;
          }, 300);
        }

        // åˆå§‹åŒ–åŠ è½½
        reload();

        return {
          total,
          listData,
          loading,
          shouldShow,
          reload,
          renderProgress
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
```

## æ€§èƒ½å¯¹æ¯”æ•°æ®

### æµ‹è¯•æ¡ä»¶
- **æ•°æ®é‡**ï¼š10000 æ¡
- **æµè§ˆå™¨**ï¼šChrome æœ€æ–°ç‰ˆ

### å¯¹æ¯”ç»“æœ

| æŒ‡æ ‡ | æœªä¼˜åŒ– | å·²ä¼˜åŒ– | æå‡ |
|-----|-------|-------|------|
| **é¦–å±æ¸²æŸ“æ—¶é—´** | ~2500ms | ~50ms | **50å€** |
| **é¡µé¢å¯äº¤äº’æ—¶é—´** | ~2500ms | ~50ms | **50å€** |
| **å®Œæ•´æ¸²æŸ“æ—¶é—´** | ~2500ms | ~3000ms | ç¨æ…¢ |
| **FPSï¼ˆæ¸²æŸ“è¿‡ç¨‹ï¼‰** | 0fpsï¼ˆå¡æ­»ï¼‰ | 60fps | **æµç•…** |
| **ç”¨æˆ·ä½“éªŒ** | âŒ å¡é¡¿ | âœ… æµç•… | **è´¨çš„é£è·ƒ** |

### å…³é”®æŒ‡æ ‡è¯´æ˜

- âœ… **é¦–å±æ¸²æŸ“æ—¶é—´**ï¼šç”¨æˆ·çœ‹åˆ°é¦–æ‰¹å†…å®¹çš„æ—¶é—´ï¼Œä¼˜åŒ–åæå‡ 50 å€
- âœ… **é¡µé¢å¯äº¤äº’æ—¶é—´**ï¼šç”¨æˆ·å¯ä»¥æ»šåŠ¨ã€ç‚¹å‡»çš„æ—¶é—´ï¼Œä¼˜åŒ–åç«‹å³å¯ç”¨
- âš ï¸ **å®Œæ•´æ¸²æŸ“æ—¶é—´**ï¼šæ‰€æœ‰å†…å®¹æ¸²æŸ“å®Œæˆçš„æ—¶é—´ï¼Œä¼˜åŒ–åç¨æ…¢ä½†ä¸å½±å“ä½“éªŒ
- âœ… **FPS**ï¼šå¸§ç‡ï¼Œä¼˜åŒ–åä¿æŒ 60fpsï¼Œç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°å¡é¡¿

## é€‚ç”¨åœºæ™¯

### âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯

1. **é•¿åˆ—è¡¨æ¸²æŸ“**
   - å•†å“åˆ—è¡¨ï¼ˆç”µå•†ï¼‰
   - è¯„è®ºåˆ—è¡¨ï¼ˆç¤¾äº¤åº”ç”¨ï¼‰
   - æœç´¢ç»“æœåˆ—è¡¨

2. **æ•°æ®å¯è§†åŒ–**
   - å¤§é‡å›¾è¡¨ç‚¹ä½
   - å¤æ‚çš„ SVG å›¾å½¢
   - Canvas ç»˜åˆ¶

3. **æ‰¹é‡ DOM æ“ä½œ**
   - è¡¨æ ¼æ¸²æŸ“ï¼ˆ10000+ è¡Œï¼‰
   - æ ‘å½¢ç»“æ„å±•å¼€
   - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

4. **é¦–å±ä¼˜åŒ–**
   - éœ€è¦å¿«é€Ÿå±•ç¤ºé¦–å±å†…å®¹
   - ç”¨æˆ·ä½“éªŒä¼˜å…ˆçš„åœºæ™¯

### âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯

1. **æ•°æ®é‡è¾ƒå°**ï¼ˆ< 1000 æ¡ï¼‰
   - é¢å¤–çš„å¤æ‚åº¦ä¸å€¼å¾—
   - å¯èƒ½åè€Œå½±å“æ€§èƒ½

2. **éœ€è¦ç«‹å³è·å–æ‰€æœ‰ DOM**
   - éœ€è¦ç«‹å³è®¡ç®—æ‰€æœ‰å…ƒç´ çš„æ€»é«˜åº¦
   - éœ€è¦å¯¹æ‰€æœ‰å…ƒç´ è¿›è¡Œæ‰¹é‡æ“ä½œ

3. **æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰**
   - requestAnimationFrame åœ¨æœåŠ¡ç«¯ä¸å¯ç”¨
   - éœ€è¦è€ƒè™‘åŒæ„æ¸²æŸ“é—®é¢˜

## è¿›é˜¶ä¼˜åŒ–

### 1. åŠ¨æ€è°ƒæ•´æ¯å¸§æ¸²æŸ“æ•°é‡

æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´æ¯å¸§æ¸²æŸ“çš„å…ƒç´ æ•°é‡ï¼š

```javascript
function useDeferredDisplay(initialStep = 100) {
  const count = ref(0);
  let rafId = null;
  
  // åŠ¨æ€æ­¥é•¿ï¼šæ€§èƒ½å¥½çš„è®¾å¤‡ä¸€æ¬¡æ¸²æŸ“æ›´å¤š
  const step = ref(initialStep);
  let frameStartTime = performance.now();

  function update() {
    const now = performance.now();
    const frameTime = now - frameStartTime;
    
    // å¦‚æœä¸Šä¸€å¸§æ‰§è¡Œæ—¶é—´ < 10msï¼Œè¯´æ˜è®¾å¤‡æ€§èƒ½å¥½ï¼Œå¯ä»¥å¢åŠ æ­¥é•¿
    if (frameTime < 10) {
      step.value = Math.min(step.value + 10, 200);
    } else if (frameTime > 16) {
      // å¦‚æœä¸Šä¸€å¸§è¶…è¿‡ 16msï¼Œè¯´æ˜è®¾å¤‡æ€§èƒ½ä¸è¶³ï¼Œå‡å°‘æ­¥é•¿
      step.value = Math.max(step.value - 10, 50);
    }
    
    count.value += step.value;
    frameStartTime = performance.now();
    rafId = requestAnimationFrame(update);
  }

  update();

  onBeforeUnmount(() => {
    if (rafId) {
      cancelAnimationFrame(rafId);
    }
  });

  return function (n) {
    return count.value >= n;
  };
}
```

### 2. ç»“åˆè™šæ‹Ÿæ»šåŠ¨

å¯¹äºè¶…é•¿åˆ—è¡¨ï¼Œå¯ä»¥ç»“åˆè™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollï¼‰è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

```javascript
// åªæ¸²æŸ“å¯è§†åŒºåŸŸ + ç¼“å†²åŒºçš„å†…å®¹
const visibleItems = computed(() => {
  const start = Math.max(0, scrollTop.value - bufferSize);
  const end = Math.min(listData.value.length, scrollTop.value + viewportHeight + bufferSize);
  
  return listData.value.slice(start, end).filter(item => shouldShow(item.id));
});
```

### 3. ä¼˜å…ˆæ¸²æŸ“å¯è§†åŒºåŸŸ

å…ˆæ¸²æŸ“ç”¨æˆ·èƒ½çœ‹åˆ°çš„å†…å®¹ï¼Œå†æ¸²æŸ“å±å¹•å¤–çš„å†…å®¹ï¼š

```javascript
function usePriorityDeferredDisplay(isVisible) {
  const visibleCount = ref(0);
  const hiddenCount = ref(0);

  function update() {
    // ä¼˜å…ˆæ¸²æŸ“å¯è§†åŒºåŸŸ
    if (visibleCount.value < totalVisible) {
      visibleCount.value++;
    } else {
      hiddenCount.value++;
    }
    requestAnimationFrame(update);
  }

  update();

  return function (n) {
    return isVisible(n) 
      ? visibleCount.value >= n 
      : hiddenCount.value >= n;
  };
}
```

## React ç‰ˆæœ¬å®ç°

```javascript
import { useState, useEffect, useRef } from 'react';

function useDeferredDisplay(step = 100) {
  const [count, setCount] = useState(0);
  const rafIdRef = useRef(null);

  useEffect(() => {
    function update() {
      setCount(prev => prev + step);
      rafIdRef.current = requestAnimationFrame(update);
    }

    update();

    return () => {
      if (rafIdRef.current) {
        cancelAnimationFrame(rafIdRef.current);
      }
    };
  }, [step]);

  return function (n) {
    return count >= n;
  };
}

// ä½¿ç”¨ç¤ºä¾‹
function ListComponent() {
  const shouldShow = useDeferredDisplay();
  const [listData] = useState(
    Array.from({ length: 10000 }, (_, i) => ({
      id: i + 1,
      title: `Item #${i + 1}`
    }))
  );

  return (
    <div className="list">
      {listData.map(item => (
        <div 
          key={item.id} 
          className="item"
          style={{ display: shouldShow(item.id) ? 'block' : 'none' }}
        >
          {item.title}
        </div>
      ))}
    </div>
  );
}
```

## åŸç”Ÿ JavaScript å®ç°

```javascript
class DeferredRenderer {
  constructor(container, items, step = 100) {
    this.container = container;
    this.items = items;
    this.count = 0;
    this.step = step;
    this.rafId = null;
    this.elements = [];
    
    this.init();
  }

  init() {
    // åˆ›å»ºæ‰€æœ‰ DOM å…ƒç´ ï¼Œä½†å…ˆéšè—
    this.items.forEach((item, index) => {
      const el = document.createElement('div');
      el.className = 'item';
      el.textContent = item.title;
      el.style.display = 'none';
      this.container.appendChild(el);
      this.elements.push(el);
    });

    // å¼€å§‹é€å¸§æ˜¾ç¤º
    this.render();
  }

  render() {
    // æ¯å¸§æ˜¾ç¤º step ä¸ªå…ƒç´ 
    const end = Math.min(this.count + this.step, this.elements.length);
    
    for (let i = this.count; i < end; i++) {
      this.elements[i].style.display = 'block';
    }
    
    this.count = end;

    if (this.count < this.elements.length) {
      this.rafId = requestAnimationFrame(() => this.render());
    }
  }

  destroy() {
    if (this.rafId) {
      cancelAnimationFrame(this.rafId);
    }
  }
}

// ä½¿ç”¨
const items = Array.from({ length: 10000 }, (_, i) => ({
  id: i + 1,
  title: `Item #${i + 1}`
}));

// åˆ›å»ºæ¸²æŸ“å™¨ï¼Œæ¯å¸§æ¸²æŸ“ 100 ä¸ªå…ƒç´ ï¼ˆé»˜è®¤å€¼ï¼‰
const renderer = new DeferredRenderer(
  document.getElementById('list'),
  items,
  100  // step å‚æ•°ï¼Œå¯é€‰
);

// æ¸…ç†
// renderer.destroy();
```

## æ³¨æ„äº‹é¡¹

### 1. å†…å­˜å ç”¨

è™½ç„¶å…ƒç´ é€å¸§æ˜¾ç¤ºï¼Œä½†æ‰€æœ‰ DOM èŠ‚ç‚¹éƒ½å·²åˆ›å»ºï¼Œå†…å­˜å ç”¨å¹¶æ²¡æœ‰å‡å°‘ã€‚å¦‚æœéœ€è¦ä¼˜åŒ–å†…å­˜ï¼Œåº”è¯¥ç»“åˆè™šæ‹Ÿæ»šåŠ¨ã€‚

```javascript
// âŒ é”™è¯¯è®¤çŸ¥ï¼šä»»åŠ¡åˆ†ç‰‡èƒ½å‡å°‘å†…å­˜å ç”¨
// å®é™…ä¸Š DOM èŠ‚ç‚¹éƒ½å·²åˆ›å»ºï¼Œåªæ˜¯é€šè¿‡ v-show æ§åˆ¶æ˜¾ç¤º

// âœ… æ­£ç¡®åšæ³•ï¼šç»“åˆè™šæ‹Ÿæ»šåŠ¨
// åªåˆ›å»ºå¯è§†åŒºåŸŸçš„ DOM èŠ‚ç‚¹
```

### 2. æ¸…ç†å®šæ—¶å™¨

ç»„ä»¶å¸è½½æ—¶ï¼Œä¸€å®šè¦æ¸…ç† `requestAnimationFrame`ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼š

```javascript
onBeforeUnmount(() => {
  if (rafId) {
    cancelAnimationFrame(rafId);
  }
});
```

### 3. é¿å…é¢‘ç¹é‡æ–°æ¸²æŸ“

å¦‚æœçˆ¶ç»„ä»¶é¢‘ç¹æ›´æ–°ï¼Œå¯èƒ½å¯¼è‡´ `count` è¢«é‡ç½®ï¼š

```javascript
// âŒ æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½ä¼šé‡ç½®è®¡æ•°å™¨
function ParentComponent() {
  const [count, setCount] = useState(0);
  
  // è¿™ä¼šå¯¼è‡´ useDeferredDisplay é‡æ–°æ‰§è¡Œ
  const shouldShow = useDeferredDisplay();
  
  return <ChildComponent shouldShow={shouldShow} />;
}

// âœ… ä½¿ç”¨ useMemo æˆ– useCallback ä¼˜åŒ–
const shouldShow = useMemo(() => useDeferredDisplay(), []);
```

### 4. SEO è€ƒè™‘

å¦‚æœé¡µé¢éœ€è¦ SEOï¼Œä½¿ç”¨ `v-show` è€Œä¸æ˜¯ `v-if`ï¼Œç¡®ä¿å†…å®¹åœ¨ HTML ä¸­å­˜åœ¨ï¼š

```vue
<!-- âœ… ä½¿ç”¨ v-showï¼Œå†…å®¹åœ¨ DOM ä¸­ï¼Œçˆ¬è™«å¯ä»¥æŠ“å– -->
<div v-show="shouldShow(item.id)">{{ item.title }}</div>

<!-- âŒ ä½¿ç”¨ v-ifï¼Œå†…å®¹ä¸åœ¨ DOM ä¸­ï¼Œçˆ¬è™«æ— æ³•æŠ“å– -->
<div v-if="shouldShow(item.id)">{{ item.title }}</div>
```

## æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ä»»åŠ¡åˆ†ç‰‡** æ˜¯è§£å†³å¤§æ•°æ®æ¸²æŸ“å¡é¡¿çš„æœ‰æ•ˆæ–¹æ¡ˆ
2. **requestAnimationFrame** æ˜¯å®ç°ä»»åŠ¡åˆ†ç‰‡çš„æœ€ä½³ API
3. **ä¼˜å…ˆä¿è¯é¦–å±ä½“éªŒ**ï¼Œå®Œæ•´åŠ è½½æ—¶é—´å¯ä»¥é€‚å½“å»¶é•¿
4. **ç»“åˆå…¶ä»–ä¼˜åŒ–æ‰‹æ®µ**ï¼ˆè™šæ‹Ÿæ»šåŠ¨ã€æ‡’åŠ è½½ï¼‰æ•ˆæœæ›´ä½³

### ä¼˜ç¼ºç‚¹

#### âœ… ä¼˜ç‚¹
- é¡µé¢ä¸ä¼šå¡é¡¿ï¼Œç”¨æˆ·ä½“éªŒå¥½
- é¦–å±æ¸²æŸ“å¿«ï¼Œç«‹å³å¯äº¤äº’
- å®ç°ç®€å•ï¼Œä»£ç ä¼˜é›…
- å…¼å®¹æ€§å¥½ï¼ˆIE10+ï¼‰

#### âš ï¸ ç¼ºç‚¹
- å®Œæ•´æ¸²æŸ“æ—¶é—´ç•¥é•¿
- å†…å­˜å ç”¨æ²¡æœ‰å‡å°‘ï¼ˆéœ€ç»“åˆè™šæ‹Ÿæ»šåŠ¨ï¼‰
- ä¸é€‚åˆéœ€è¦ç«‹å³è·å–æ‰€æœ‰ DOM çš„åœºæ™¯

### æœ€ä½³å®è·µ

1. **æ•°æ®é‡ > 1000 æ—¶è€ƒè™‘ä½¿ç”¨**
2. **ç»“åˆè™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–å†…å­˜**
3. **åŠ¨æ€è°ƒæ•´æ¯å¸§æ¸²æŸ“æ•°é‡**
4. **ä¼˜å…ˆæ¸²æŸ“å¯è§†åŒºåŸŸå†…å®¹**
5. **è®°å¾—æ¸…ç† requestAnimationFrame**



